(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):(a=a||self,b(a.dline={}))})(this,function(a){'use strict';var r=Math.abs,s=Math.floor;function b(a){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b(a)}function c(a){return d(a)||e(a)||f()}function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function e(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function g(a,b){var c=Math.cos,d=Math.sin,e=function(a){return a.map(function(a){return a*Math.PI/180})},f=e(a),g=e(b);return 6372795*Math.acos(d(f[0])*d(g[0])+c(f[0])*c(g[0])*c(f[1]-g[1]))}function h(a,b,d){function e(a){var b=Math.ceil(a);return b%2?b:s(a)}if("meters"===d){var f=[a[3],a[0]],h=[a[1],a[0]],i=g(h,f),j=e(i/b),k=r(a[1]-a[3])*b/i,l=[a[1],a[0]],m=[a[1],a[2]],n=g(m,l),o=e(n/b),p=r(a[0]-a[2])*b/n;return{latSize:j,longSize:o,latCellSize:k,longCellSize:p}}if("degrees"===d){var q;Array.isArray(b)?1===b.length?q=[b[0],b[0]]:2===b.length&&(q=c(b)):q=[b,b];var t=r(a[1]-a[3]),u=e(t/q[0]),v=r(a[0]-a[2]),w=e(v/q[1]);return{latSize:u,longSize:w,latCellSize:q[0],longCellSize:q[1]}}throw new Error("wtf")}function i(a,b){var d=Math.max,e=Math.min;if(!Array.isArray(a))throw new Error("percents is not array");var f=e.apply(Math,c(b.map(function(a){return a[0]}))),g=e.apply(Math,c(b.map(function(a){return a[1]}))),h=d.apply(Math,c(b.map(function(a){return a[0]}))),i=d.apply(Math,c(b.map(function(a){return a[1]}))),j=i-g,k=h-f,l=j*(100+a[0])/100,m=k*(100+a[1])/100;return[g-(l-j)/2,f-(m-k)/2,i+(l-j)/2,h+(m-k)/2]}function j(a,c){var d=a.bbox,e=a.units,f=a.exponent,g=a.mask,h=a.boundaries;switch(b(d)){case"undefined":d=i([0,0],c);break;case"object":if(!Array.isArray(d))throw new Error("bbox is not array");if(0===d.length)d=i([0,0],c);else if(2===d.length)d.forEach(function(a){if("number"!=typeof a||0>a)throw new Error("invalid bbox values")}),d=i(d,c);else if(4===d.length)d.forEach(function(a){if("number"!=typeof a)throw new Error("invalid bbox values")});else throw new Error("invalid bbox length");break;default:throw new Error("bbox is not array");}switch(b(e)){case"string":case"undefined":if("meters"===e||e===void 0)e=["meters","meters"];else if("degrees"===e)e=["degrees","degrees"];else throw new Error("invalid units values");break;case"object":if(!Array.isArray(e))throw new Error("units is not array");if(2===e.length)e.forEach(function(a){if("meters"!==a&&"degrees"!==a)throw new Error("invalid units values")});else throw new Error("invalid units length");break;default:throw new Error("invalid units values");}f||(f=2);var j,k;if(g)if(h){var l=function(a){var b=a.filter(function(a){return 0<a[0]}).sort(function(c,a){return a[0]-c[0]});return b.unshift([1/0]),!!b.length&&b},m=function(a){var b=a.filter(function(a){return 0>a[0]}).sort(function(c,a){return a[0]-c[0]});return b.push([-Infinity]),!!b.length&&b};j=m(h),k=l(h)}else throw new Error("boundaries is undefined");return{bbox:d,units:e,exponent:f,mask:g,lowerIntervals:j,upperIntervals:k}}function k(){for(var a="ncols         ".concat(((this.bbox[2]-this.bbox[0])/this.longCellSize).toFixed(),"\nnrows         ").concat(((this.bbox[3]-this.bbox[1])/this.latCellSize).toFixed(),"\nxllcorner     ").concat(this.bbox[0],"\nyllcorner     ").concat(this.bbox[1],"\ncellsize      ").concat(this.latCellSize,"\nNODATA_value  -9999\n"),b=this.grid.length-1;0<=b;b--)a+=" "+this.grid[b].join(" ")+"\n";return a}function l(){for(var a={type:"FeatureCollection",features:[]},b=0;b<this.grid.length;b++)for(var c=0;c<this.grid[b].length;c++)this.grid[b][c]&&a.features.push({type:"Feature",properties:{value:this.grid[b][c]},geometry:{type:"Point",coordinates:[c*this.longCellSize+this.bbox[0],b*this.latCellSize+this.bbox[1]]}});return a}function m(a){for(var b=[],c=!0;0<a.length;){!0===c&&(b.push([]),b[b.length-1].push([a[0][0],a[0][1]],[a[0][2],a[0][3]]),a.splice(0,1)),c=!0;for(var d=0,e=a.length;d<e;d++){if(b[b.length-1][b[b.length-1].length-1][0]===a[d][0]&&b[b.length-1][b[b.length-1].length-1][1]===a[d][1]){b[b.length-1].push([a[d][2],a[d][3]]),a.splice(d,1),c=!1;break}else if(b[b.length-1][b[b.length-1].length-1][0]===a[d][2]&&b[b.length-1][b[b.length-1].length-1][1]===a[d][3]){b[b.length-1].push([a[d][0],a[d][1]]),a.splice(d,1),c=!1;break}if(b[b.length-1][0][0]===a[d][0]&&b[b.length-1][0][1]===a[d][1]){b[b.length-1].unshift([a[d][2],a[d][3]]),a.splice(d,1),c=!1;break}else if(b[b.length-1][0][0]===a[d][2]&&b[b.length-1][0][1]===a[d][3]){b[b.length-1].unshift([a[d][0],a[d][1]]),a.splice(d,1),c=!1;break}}}return b}function n(a){for(var b,c={},d=0;d<a.length;d++){b=[];for(var e=0;e<a.length;e++)d!==e&&o(a[d][0][1],a[d][0][0],a[e])&&b.push(e);c[[d]]=b}for(var f,g=[],h=0;h<a.length;h++){for(var k in f=[],c)c[k][c[k].length-1]===h&&0==(c[k].length-1)%2&&f.push(a[k]);0!=(c[[h]].length-1)%2&&g.push([a[h]].concat(f))}return g}function o(a,b,d){for(var e=d.length,f=e-1,g=!1,h=0;h<e;h++)(d[h][0]<=b&&b<d[f][0]||d[f][0]<=b&&b<d[h][0])&&a>(d[f][1]-d[h][1])*(b-d[h][0])/(d[f][0]-d[h][0])+d[h][1]&&(g=!g),f=h;return g}function p(a,b,d){function e(a,b,d,e){switch(a){case"a-":return[].concat(c(q(b,d,0,e)),c(u(b,d,1,e)));case"b-":return[].concat(c(s(b,d,1,e)),c(q(b,d,1,e)));case"c-":return[].concat(c(t(b,d,1,e)),c(s(b,d,0,e)));case"d-":return[].concat(c(u(b,d,0,e)),c(t(b,d,0,e)));case"a+":return[].concat(c(q(b,d,1,e)),c(u(b,d,0,e)));case"b+":return[].concat(c(s(b,d,0,e)),c(q(b,d,0,e)));case"c+":return[].concat(c(t(b,d,0,e)),c(s(b,d,1,e)));case"d+":return[].concat(c(u(b,d,1,e)),c(t(b,d,1,e)));case"l>r":return[].concat(c(q(b,d,1,e)),c(t(b,d,1,e)));case"r>l":return[].concat(c(q(b,d,0,e)),c(t(b,d,0,e)));case"t>b":return[].concat(c(s(b,d,0,e)),c(u(b,d,0,e)));case"b>t":return[].concat(c(s(b,d,1,e)),c(u(b,d,1,e)));default:throw new Error("imposible");}}function f(b,c){if(0!==b&&0!==c&&b!==a.length-2&&c!==a[b].length-2)return 0;if(b===a.length-2&&0!==c&&c!==a[b].length-2)return"top";if(b!==a.length-2&&0!==b&&c===a[b].length-2)return"right";if(0===b&&c!==a[b].length-2&&0!==c)return"bot";if(b!==a.length-2&&0===c&&0!==b)return"left";if(b===a.length-2&&0===c)return"A";if(b===a.length-2&&c===a[b].length-2)return"B";if(0===b&&c===a[b].length-2)return"C";if(0===b&&0===c)return"D";throw new Error("invalid x or y")}function g(a,c){var e=(m(a,c)+n(a,c)+o(a,c)+p(a,c))/4;return e<=b?0:e>b&&e<=d?1:2}function h(a,c,f){var h;"2221"===a?w.push(e("d-",c,f,d)):"1112"===a?w.push(e("d+",c,f,d)):"0001"===a?w.push(e("d+",c,f,b)):"1110"===a?w.push(e("d-",c,f,b)):"2212"===a?w.push(e("c-",c,f,d)):"1121"===a?w.push(e("c+",c,f,d)):"0010"===a?w.push(e("c+",c,f,b)):"1101"===a?w.push(e("c-",c,f,b)):"2122"===a?w.push(e("b-",c,f,d)):"1211"===a?w.push(e("b+",c,f,d)):"0100"===a?w.push(e("b+",c,f,b)):"1011"===a?w.push(e("b-",c,f,b)):"1222"===a?w.push(e("a-",c,f,d)):"2111"===a?w.push(e("a+",c,f,d)):"1000"===a?w.push(e("a+",c,f,b)):"0111"===a?w.push(e("a-",c,f,b)):"0011"===a?w.push(e("b>t",c,f,b)):"1100"===a?w.push(e("t>b",c,f,b)):"2211"===a?w.push(e("t>b",c,f,d)):"1122"===a?w.push(e("b>t",c,f,d)):"0110"===a?w.push(e("r>l",c,f,b)):"1001"===a?w.push(e("l>r",c,f,b)):"2112"===a?w.push(e("l>r",c,f,d)):"1221"===a?w.push(e("r>l",c,f,d)):"2200"===a?w.push(e("t>b",c,f,d),e("t>b",c,f,b)):"0022"===a?w.push(e("b>t",c,f,d),e("b>t",c,f,b)):"2002"===a?w.push(e("l>r",c,f,d),e("l>r",c,f,b)):"0220"===a?w.push(e("r>l",c,f,d),e("r>l",c,f,b)):"2220"===a?w.push(e("d-",c,f,d),e("d-",c,f,b)):"0002"===a?w.push(e("d+",c,f,b),e("d+",c,f,d)):"2202"===a?w.push(e("c-",c,f,d),e("c-",c,f,b)):"0020"===a?w.push(e("c+",c,f,b),e("c+",c,f,d)):"2022"===a?w.push(e("b-",c,f,d),e("b-",c,f,b)):"0200"===a?w.push(e("b+",c,f,b),e("b+",c,f,d)):"0222"===a?w.push(e("a-",c,f,d),e("a-",c,f,b)):"2000"===a?w.push(e("a+",c,f,b),e("a+",c,f,d)):"1200"===a?w.push(e("b+",c,f,d),e("t>b",c,f,b)):"0120"===a?w.push(e("c+",c,f,d),e("r>l",c,f,b)):"0012"===a?w.push(e("d+",c,f,d),e("b>t",c,f,b)):"2001"===a?w.push(e("a+",c,f,d),e("l>r",c,f,b)):"1022"===a?w.push(e("b-",c,f,b),e("b>t",c,f,d)):"2102"===a?w.push(e("c-",c,f,b),e("l>r",c,f,d)):"2210"===a?w.push(e("d-",c,f,b),e("t>b",c,f,d)):"0221"===a?w.push(e("a-",c,f,b),e("r>l",c,f,d)):"1002"===a?w.push(e("d+",c,f,d),e("l>r",c,f,b)):"2100"===a?w.push(e("a+",c,f,d),e("t>b",c,f,b)):"0210"===a?w.push(e("b+",c,f,d),e("r>l",c,f,b)):"0021"===a?w.push(e("c+",c,f,d),e("b>t",c,f,b)):"1220"===a?w.push(e("d-",c,f,b),e("r>l",c,f,d)):"0122"===a?w.push(e("a-",c,f,b),e("b>t",c,f,d)):"2012"===a?w.push(e("b-",c,f,b),e("l>r",c,f,d)):"2201"===a?w.push(e("c-",c,f,b),e("t>b",c,f,d)):"0211"===a?w.push(e("a-",c,f,b),e("b+",c,f,d)):"2110"===a?w.push(e("a+",c,f,d),e("d-",c,f,b)):"1102"===a?w.push(e("c-",c,f,b),e("d+",c,f,d)):"1021"===a?w.push(e("b-",c,f,b),e("c+",c,f,d)):"2011"===a?w.push(e("a+",c,f,d),e("b-",c,f,b)):"0112"===a?w.push(e("a-",c,f,b),e("d+",c,f,d)):"1120"===a?w.push(e("c+",c,f,d),e("d-",c,f,b)):"1201"===a?w.push(e("b+",c,f,d),e("c-",c,f,b)):"2101"===a?w.push(e("a+",c,f,d),e("c-",c,f,b)):"0121"===a?w.push(e("a-",c,f,b),e("c+",c,f,d)):"1012"===a?w.push(e("b-",c,f,b),e("d+",c,f,d)):"1210"===a?w.push(e("b+",c,f,d),e("d-",c,f,b)):"2020"===a?(h=g(c,f),0===h?w.push(e("a+",c,f,d),e("a+",c,f,b),e("c+",c,f,d),e("c+",c,f,b)):1===h?w.push(e("a+",c,f,d),e("b-",c,f,b),e("c+",c,f,d),e("d-",c,f,b)):2===h&&w.push(e("b-",c,f,d),e("b-",c,f,b),e("d-",c,f,d),e("d-",c,f,b))):"0202"===a?(h=g(c,f),0===h?w.push(e("b+",c,f,d),e("b+",c,f,b),e("d+",c,f,d),e("d+",c,f,b)):1===h?w.push(e("a-",c,f,b),e("b+",c,f,d),e("c-",c,f,b),e("d+",c,f,d)):2===h&&w.push(e("a-",c,f,d),e("a-",c,f,b),e("c-",c,f,d),e("c-",c,f,b))):"0101"===a?(h=g(c,f),0===h?w.push(e("b+",c,f,b),e("d+",c,f,b)):1===h&&w.push(e("a-",c,f,b),e("c-",c,f,b))):"1010"===a?(h=g(c,f),0===h?w.push(e("a+",c,f,b),e("c+",c,f,b)):1===h&&w.push(e("b-",c,f,b),e("d-",c,f,b))):"2121"===a?(h=g(c,f),1===h?w.push(e("a+",c,f,d),e("c+",c,f,d)):2===h&&w.push(e("b-",c,f,d),e("d-",c,f,d))):"1212"===a?(h=g(c,f),1===h?w.push(e("b+",c,f,d),e("d+",c,f,d)):2===h&&w.push(e("a-",c,f,d),e("c-",c,f,d))):"2120"===a?(h=g(c,f),1===h?w.push(e("a+",c,f,d),e("c+",c,f,d),e("d-",c,f,b)):2===h&&w.push(e("b-",c,f,d),e("d-",c,f,d),e("d-",c,f,b))):"2021"===a?(h=g(c,f),1===h?w.push(e("a+",c,f,d),e("b-",c,f,b),e("c+",c,f,d)):2===h&&w.push(e("b-",c,f,d),e("b-",c,f,b),e("d-",c,f,d))):"1202"===a?(h=g(c,f),1===h?w.push(e("b+",c,f,d),e("c-",c,f,b),e("d+",c,f,d)):2===h&&w.push(e("a-",c,f,d),e("c-",c,f,d),e("c-",c,f,b))):"0212"===a?(h=g(c,f),1===h?w.push(e("a-",c,f,b),e("b+",c,f,d),e("d+",c,f,d)):2===h&&w.push(e("a-",c,f,d),e("a-",c,f,b),e("c-",c,f,d))):"0102"===a?(h=g(c,f),0===h?w.push(e("b+",c,f,b),e("d+",c,f,d),e("d+",c,f,b)):1===h&&w.push(e("a-",c,f,b),e("c-",c,f,b),e("d+",c,f,d))):"0201"===a?(h=g(c,f),0===h?w.push(e("b+",c,f,d),e("b+",c,f,b),e("d+",c,f,b)):1===h&&w.push(e("a-",c,f,b),e("b+",c,f,d),e("c-",c,f,b))):"1020"===a?(h=g(c,f),0===h?w.push(e("a+",c,f,b),e("c+",c,f,d),e("c+",c,f,b)):1===h&&w.push(e("b-",c,f,b),e("c+",c,f,d),e("d-",c,f,b))):"2010"===a?(h=g(c,f),0===h?w.push(e("a+",c,f,d),e("a+",c,f,b),e("c+",c,f,b)):1===h&&w.push(e("a+",c,f,d),e("b-",c,f,b),e("d-",c,f,b))):void 0}function k(a,e,f,g){function h(a){return"01"===a?[].concat(c(q(e,f,0,b)),[e+1,f+1]):"02"===a?[].concat(c(q(e,f,0,b)),c(q(e,f,0,d))):"10"===a?[].concat(c(q(e,f,1,b)),[e+1,f]):"11"===a?[e+1,f,e+1,f+1]:"12"===a?[].concat(c(q(e,f,0,d)),[e+1,f]):"20"===a?[].concat(c(q(e,f,1,b)),c(q(e,f,1,d))):!("21"!=a)&&[].concat(c(q(e,f,1,d)),[e+1,f+1])}function i(a){return"01"===a?[].concat(c(s(e,f,1,b)),[e,f+1]):"02"===a?[].concat(c(s(e,f,1,b)),c(s(e,f,1,d))):"10"===a?[].concat(c(s(e,f,0,b)),[e+1,f+1]):"11"===a?[e+1,f+1,e,f+1]:"12"===a?[].concat(c(s(e,f,1,d)),[e+1,f+1]):"20"===a?[].concat(c(s(e,f,0,b)),c(s(e,f,0,d))):!("21"!=a)&&[].concat(c(s(e,f,0,d)),[e,f+1])}function j(a){return"01"===a?[].concat(c(t(e,f,1,b)),[e,f]):"02"===a?[].concat(c(t(e,f,1,b)),c(t(e,f,1,d))):"10"===a?[].concat(c(t(e,f,0,b)),[e,f+1]):"11"===a?[e,f+1,e,f]:"12"===a?[].concat(c(t(e,f,1,d)),[e,f+1]):"20"===a?[].concat(c(t(e,f,0,b)),c(t(e,f,0,d))):!("21"!=a)&&[].concat(c(t(e,f,0,d)),[e,f])}function k(a){return"01"===a?[].concat(c(u(e,f,0,b)),[e+1,f]):"02"===a?[].concat(c(u(e,f,0,b)),c(u(e,f,0,d))):"10"===a?[].concat(c(u(e,f,1,b)),[e,f]):"11"===a?[e,f,e+1,f]:"12"===a?[].concat(c(u(e,f,0,d)),[e,f]):"20"===a?[].concat(c(u(e,f,1,b)),c(u(e,f,1,d))):!("21"!=a)&&[].concat(c(u(e,f,1,d)),[e+1,f])}var l;"top"===g?(l=h(a[0]+a[1]),l&&w.push(l)):"right"===g?(l=i(a[1]+a[2]),l&&w.push(l)):"bot"===g?(l=j(a[2]+a[3]),l&&w.push(l)):"left"===g?(l=k(a[3]+a[0]),l&&w.push(l)):"A"===g?(l=k(a[3]+a[0]),l&&w.push(l),l=h(a[0]+a[1]),l&&w.push(l)):"B"===g?(l=h(a[0]+a[1]),l&&w.push(l),l=i(a[1]+a[2]),l&&w.push(l)):"C"===g?(l=i(a[1]+a[2]),l&&w.push(l),l=j(a[2]+a[3]),l&&w.push(l)):"D"===g?(l=j(a[2]+a[3]),l&&w.push(l),l=k(a[3]+a[0]),l&&w.push(l)):void 0}for(var l=function(a,b,d){return a>d?(d+1e-4-b)/(a-b):(d+1e-4-a)/(b-a)},m=function(b,c){return a[b+1][c]},n=function(b,c){return a[b+1][c+1]},o=function(b,c){return a[b][c+1]},p=function(b,c){return a[b][c]},q=function(a,b,d,c){return[a+1,b+r(d-l(m(a,b),n(a,b),c))]},s=function(a,b,d,c){return[a+r(d-l(n(a,b),o(a,b),c)),b+1]},t=function(a,b,d,c){return[a,b+r(d-l(o(a,b),p(a,b),c))]},u=function(a,b,d,c){return[a+r(d-l(p(a,b),m(a,b),c)),b]},v=function(e,a,f,c){var g=function(a){return a<=b||Number.isNaN(a)?"0":a>b&&a<=d?"1":"2"};return g(e)+g(a)+g(f)+g(c)},w=[],x=0,y=a.length-1;x<y;x++)for(var z,A=0,B=a[x].length-1;A<B;A++)if(z=v(m(x,A),n(x,A),o(x,A),p(x,A)),"0000"!==z&&"2222"!==z){"1111"!==z&&h(z,x,A);var C=f(x,A);C&&k(z,x,A,C)}return w}function q(a,b){function d(a,b,d){switch(a){case"a-":return[].concat(c(m(b,d,0)),c(p(b,d,1)));case"b-":return[].concat(c(n(b,d,1)),c(m(b,d,1)));case"c-":return[].concat(c(o(b,d,1)),c(n(b,d,0)));case"d-":return[].concat(c(p(b,d,0)),c(o(b,d,0)));case"a+":return[].concat(c(m(b,d,1)),c(p(b,d,0)));case"b+":return[].concat(c(n(b,d,0)),c(m(b,d,0)));case"c+":return[].concat(c(o(b,d,0)),c(n(b,d,1)));case"d+":return[].concat(c(p(b,d,1)),c(o(b,d,1)));case"l>r":return[].concat(c(m(b,d,1)),c(o(b,d,1)));case"r>l":return[].concat(c(m(b,d,0)),c(o(b,d,0)));case"t>b":return[].concat(c(n(b,d,0)),c(p(b,d,0)));case"b>t":return[].concat(c(n(b,d,1)),c(p(b,d,1)));default:console.error("wtf?");}}function e(a,b,c){if("0000"!==a&&"1111"!==a){var e;"1110"===a?t.push(d("d-",b,c)):"0001"===a?t.push(d("d+",b,c)):"1101"===a?t.push(d("c-",b,c)):"0010"===a?t.push(d("c+",b,c)):"1011"===a?t.push(d("b-",b,c)):"0100"===a?t.push(d("b+",b,c)):"0111"===a?t.push(d("a-",b,c)):"1000"===a?t.push(d("a+",b,c)):"1100"===a?t.push(d("t>b",b,c)):"0011"===a?t.push(d("b>t",b,c)):"1001"===a?t.push(d("l>r",b,c)):"0110"===a?t.push(d("r>l",b,c)):"1010"===a?(e=q(b,c),0===e?t.push(d("a+",b,c),d("c+",b,c)):1===e&&t.push(d("b-",b,c),d("d-",b,c))):"0101"===a?(e=q(b,c),0===e?t.push(d("b+",b,c),d("d+",b,c)):1===e&&t.push(d("a-",b,c),d("c-",b,c))):void 0}}for(var f=function(a,c){return a>b?(b-c)/(a-c):(b-a)/(c-a)},g=function(b,c){return a[b+1][c]},h=function(b,c){return a[b+1][c+1]},k=function(b,c){return a[b][c+1]},l=function(b,c){return a[b][c]},m=function(a,b,d){return[a+1,b+r(d-f(g(a,b),h(a,b)))]},n=function(a,b,d){return[a+r(d-f(h(a,b),k(a,b))),b+1]},o=function(a,b,d){return[a,b+r(d-f(k(a,b),l(a,b)))]},p=function(a,b,d){return[a+r(d-f(l(a,b),g(a,b))),b]},q=function(a,c){return(g(a,c)+h(a,c)+k(a,c)+l(a,c))/4<=b?0:1},s=function(e,a,f,c){var d=function(a){return a<=b?"0":"1"};return d(e)+d(a)+d(f)+d(c)},t=[],u=0,v=a.length-1;u<v;u++)for(var w=0,x=a[u].length-1;w<x;w++)e(s(g(u,w),h(u,w),k(u,w),l(u,w)),u,w);return t}a.IDW=function(a,b){var m=Math.sqrt,n=Math.pow;function c(a,b){for(var c=[],d=0;d<A;d++){c[d]=[];for(var e=0;e<B;e++)c[d][e]=a(b,d,e)}return c}function d(a){return a.map(function(a){return[r(t[1]-a[0])/C,r(t[0]-a[1])/D,a[2]]})}function e(b,c,d){var e=s(r(w.bbox[0]-a[d][1])/w.longCellSize),g=s(r(w.bbox[1]-a[d][0])/w.latCellSize),h=s(r(w.bbox[0]-(c*D+t[0]))/w.longCellSize),i=s(r(w.bbox[1]-(b*C+t[1]))/w.latCellSize),j=f(g,e,i,h),k=0;return j.forEach(function(a){if(a!==w.noData&&j[0]!==w.noData){var b=a-j[0];if(0<b){if(y)for(var c=1;c<y.length;c++)if(b>=y[c][0]&&b<y[c-1][0]){k+=y[c][1];break}}else if(0>b&&x)for(var d=1;d<x.length;d++)if(b>x[d][0]&&b<=x[d-1][0]){k+=x[d-1][1];break}}}),k}function f(a,b,c,d){for(var e=[],f=r(c-a),g=r(d-b),h=a<c?1:-1,i=b<d?1:-1,j=f-g;a!=c||b!=d;){e.push(w.grid[a][b]);var k=2*j;k>-g&&(j-=g,a+=h),k<f&&(j+=f,b+=i)}return e.push(w.grid[c][d]),e}var o,p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},q=j(p,a),t=q.bbox,u=q.units,v=q.exponent,w=q.mask,x=q.lowerIntervals,y=q.upperIntervals,z=h(t,b,u[0]),A=z.latSize,B=z.longSize,C=z.latCellSize,D=z.longCellSize;if("degrees"===u[1]){if(!w)o=c(function(a,b,c){var e=[b+.5,c+.5],f=0,g=0;return a.forEach(function(a){var b=m(n(e[0]-a[0],2)+n(e[1]-a[1],2));f+=a[2]/n(b,v),g+=1/n(b,v)}),f/g},d(a));else if(t[0]>=w.bbox[0]&&t[1]>=w.bbox[1]&&t[2]<=w.bbox[2]&&t[3]<=w.bbox[3])o=c(function(a,b,c){var f=[b+.5,c+.5],g=0,h=0;return a.forEach(function(a,i){var j=e(b,c,i),k=m(n(f[0]-a[0],2)+n(f[1]-a[1],2));g+=a[2]/n(k,v+j),h+=1/n(k,v+j)}),g/h},d(a));else throw new Error("mask shoud be bigger then bbox");}else if("meters"===u[1])if(!w)o=c(function(a,b,c){var e=[t[1]+(b+.5)*C,t[0]+(c+.5)*D],f=0,h=0;return a.forEach(function(a){var b=g(a,e);f+=a[2]/n(b,v),h+=1/n(b,v)}),f/h},a);else if(t[0]>=w.bbox[0]&&t[1]>=w.bbox[1]&&t[2]<=w.bbox[2]&&t[3]<=w.bbox[3])o=c(function(a,b,c){var f=[t[1]+(b+.5)*C,t[0]+(c+.5)*D],h=0,i=0;return a.forEach(function(a,j){var k=e(b,c,j),l=g(a,f);h+=a[2]/n(l,v+k),i+=1/n(l,v+k)}),h/i},a);else throw new Error("mask shoud be bigger then bbox");return{grid:o,latCellSize:C,longCellSize:D,bbox:t,toAsc:k,toGeoJson:l}},a.ascToArray=function(a){for(var b,c,d,e,f,g=[],h=a.split("\n"),j=0,k=h[j].split(" ");"NODATA_value"!==k[0];){switch(k[0]){case"ncols":b=+k[k.length-1];break;case"nrows":c=+k[k.length-1];break;case"xllcorner":e=+k[k.length-1];break;case"yllcorner":d=+k[k.length-1];break;case"cellsize":f=+k[k.length-1];}j++,k=h[j].split(" ")}k=h[j].split(" ");for(var m=+k[k.length-1],n=j+1;n<h.length-1;n++){g.push([]);var o=h[n].split(" ");o.forEach(function(a){""!==a&&g[g.length-1].push(+a)})}return{grid:g.reverse(),latCellSize:f,longCellSize:f,bbox:[e,d,e+b*f,d+c*f],noData:m,toGeoJson:l}},a.isobands=function(a,b){var c={type:"FeatureCollection",features:[]},d=[],e=[],f=-Infinity,g=b[0];d.push(m(p(a.grid,f,g))),e.push("<"+b[0]);for(var h=0;h<b.length-1;h++)f=b[h],g=b[h+1],d.push(m(p(a.grid,f,g))),e.push(f+"-"+g);f=b[b.length-1],g=1/0,d.push(m(p(a.grid,f,g))),e.push(b[b.length-1]+"<");for(var l=[],o=0;o<d.length;o++){l.push([]);for(var q=0;q<d[o].length;q++){l[o].push([]);for(var r=0;r<d[o][q].length;r++)l[o][q].push([d[o][q][r][1]*a.longCellSize+a.bbox[0],d[o][q][r][0]*a.latCellSize+a.bbox[1]])}}for(var s=0;s<l.length;s++)c.features.push({type:"Feature",properties:{value:e[s]},geometry:{type:"MultiPolygon",coordinates:n(l[s])}});return c},a.isolines=function(a,b){for(var c,d=[],e=[],f={type:"FeatureCollection",features:[]},g=0;g<b.length;g++)c=b[g],d.push(m(q(a.grid,c))),e.push(c);for(var l=0;l<d.length;l++)for(var n=0;n<d[l].length;n++){for(var o,p=0;p<d[l][n].length;p++)o=d[l][n][p][0]*a.latCellSize+a.bbox[1],d[l][n][p][0]=d[l][n][p][1]*a.longCellSize+a.bbox[0],d[l][n][p][1]=o;f.features.push({type:"Feature",properties:{value:e[l]},geometry:{type:"LineString",coordinates:d[l][n]}})}return f},a.pointGridToArray=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"value",c=[a.features[0].geometry.coordinates[0],a.features[0].geometry.coordinates[1]];if(a.features[1].geometry.coordinates[0]===c[0]){for(var d,e,f=a.features[1].geometry.coordinates[1]-c[1],g=1;g<a.features.length;g++)if(a.features[g].geometry.coordinates[1]===c[1]){d=a.features[g].geometry.coordinates[0]-c[0],e=g;break}var h=a.features.length/e;c.push(c[0]+h*d,c[1]+e*f);var l=[];return a.features.forEach(function(a,c){var d=s(c/e),f=c-d*e;l[f]||(l[f]=[]),l[f][d]=a.properties[[b]]}),{grid:l,latCellSize:f,longCellSize:d,bbox:c,toAsc:k}}for(var m,n,o=a.features[1].geometry.coordinates[0]-c[0],p=1;p<a.features.length;p++)if(a.features[p].geometry.coordinates[0]===c[0]){m=a.features[p].geometry.coordinates[1]-c[1],n=p;break}var j=a.features.length/n;c.push(c[0]+n*o,c[1]+j*m);var q=[];return a.features.forEach(function(a,c){var d=s(c/n),e=c-d*n;q[d]||(q[d]=[]),q[d][e]=a.properties[[b]]}),{grid:q,latCellSize:m,longCellSize:o,bbox:c,toAsc:k}},a.pointsToArray=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"value";return a.features.map(function(a){return[].concat(c(a.geometry.coordinates.reverse()),[a.properties[[b]]])})},Object.defineProperty(a,"__esModule",{value:!0})});
